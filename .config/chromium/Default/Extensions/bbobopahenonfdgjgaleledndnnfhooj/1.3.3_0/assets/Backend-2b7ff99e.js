import{o as d,r as p,g as f}from"./Config-486537b1.js";const w=Object.prototype.toString,g=t=>w.call(t)==="[object Error]",h=new Set(["network error","Failed to fetch","NetworkError when attempting to fetch resource.","The Internet connection appears to be offline.","Network request failed","fetch failed","terminated"," A network error occurred.","Network connection lost"]);function y(t){if(!(t&&g(t)&&t.name==="TypeError"&&typeof t.message=="string"))return!1;const{message:r,stack:i}=t;return r==="Load failed"?i===void 0||"__sentry_captured__"in t:r.startsWith("error sending request for url")?!0:h.has(r)}class m extends Error{constructor(e){super(),this.response=e}}class k extends Error{}function a(t,e=""){return new E(`http://localhost:${t}/${e}`)}class E{constructor(e){this.apiUrl=e}async request(e,r){const s=new AbortController,u=setTimeout(()=>s.abort(),2e3);let n;try{n=await fetch(this.apiUrl+e,{method:"POST",body:JSON.stringify(r),signal:s.signal}),clearTimeout(u)}catch(c){throw y(c)||s.signal.aborted?new k:c}if(!n.ok)throw new m(n);return n}async addDownloadLegacy(e){return this.request("add",e)}async addDownload(e){return this.request("add",e)}async ping(){return this.request("ping",null)}}let o=null;async function l(){if(o===null){const t=f();o=a(t.port)}return o}d.addEventListener(t=>{p(async()=>{const e=t.port;o=a(e)})});async function A(t,e){return await(await l()).addDownload({items:t,options:e})}async function N(t=null){let e;t!==null?e=a(t):e=await l();try{return await e.ping(),!0}catch{return!1}}export{m as A,k as N,A as a,N as p};
